


<!DOCTYPE html>
<html id="htmlId">
<head>
  <title>Coverage Report > Kweb</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/idea.min.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.min.js"></script>
  <script type="text/javascript" src="../../js/highlightjs-line-numbers.min.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope:     <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">kweb</a>
</div>

<h1>Coverage Summary for Class: Kweb (kweb)</h1>

<table class="coverageStats">

<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Branch, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
<th class="coverageStat 
">
  Instruction, %
</th>
</tr>
<tr>
  <td class="name">Kweb</td>
<td class="coverageStat">
  <span class="percent">
    84.2%
  </span>
  <span class="absValue">
    (16/19)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    54.4%
  </span>
  <span class="absValue">
    (37/68)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    75%
  </span>
  <span class="absValue">
    (129/172)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    71%
  </span>
  <span class="absValue">
    (854/1203)
  </span>
</td>
</tr>
  <tr>
    <td class="name">Kweb$1</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (1/1)
  </span>
</td>
    <td class="coverageStat"/>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (1/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (3/3)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">Kweb$clientState$2</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/8)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">Kweb$createServer$1</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (1/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    50%
  </span>
  <span class="absValue">
    (1/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    85.7%
  </span>
  <span class="absValue">
    (6/7)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    82.4%
  </span>
  <span class="absValue">
    (28/34)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">Kweb$createServer$1$1</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (1/1)
  </span>
</td>
    <td class="coverageStat"/>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (4/4)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (32/32)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">Kweb$createServer$1$1$1</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (1/1)
  </span>
</td>
    <td class="coverageStat"/>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (2/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (17/17)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">Kweb$ensureSessionExists$1</td>
    <td class="coverageStat"/>
  </tr>
  <tr>
    <td class="name">Kweb$Feature</td>
<td class="coverageStat">
  <span class="percent">
    33.3%
  </span>
  <span class="absValue">
    (1/3)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    9.1%
  </span>
  <span class="absValue">
    (1/11)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    4.1%
  </span>
  <span class="absValue">
    (2/49)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">Kweb$Feature$Configuration</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
    <td class="coverageStat"/>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/5)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/37)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">Kweb$Feature$install$1$1</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
    <td class="coverageStat"/>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">Kweb$installRequiredKwebComponents$1</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (1/1)
  </span>
</td>
    <td class="coverageStat"/>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (1/1)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">Kweb$installRequiredKwebComponents$2</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (1/1)
  </span>
</td>
    <td class="coverageStat"/>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (1/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (14/14)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">Kweb$installRequiredKwebComponents$2$1</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (1/1)
  </span>
</td>
    <td class="coverageStat"/>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (2/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (18/18)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">Kweb$listenForWebsocketConnection$1</td>
    <td class="coverageStat"/>
  </tr>
  <tr>
    <td class="name">Kweb$listenForWebsocketConnection$2</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (1/1)
  </span>
</td>
    <td class="coverageStat"/>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (1/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (4/4)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">Kweb$listenForWebsocketConnection$3</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (1/1)
  </span>
</td>
    <td class="coverageStat"/>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (1/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (7/7)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">Kweb$listenForWebsocketConnection$5</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (1/1)
  </span>
</td>
    <td class="coverageStat"/>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (1/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (4/4)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">Kweb$listenForWebsocketConnection$7</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (1/1)
  </span>
</td>
    <td class="coverageStat"/>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (1/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (1/1)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">Kweb$listenForWebsocketConnection$8</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (1/1)
  </span>
</td>
    <td class="coverageStat"/>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (1/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (3/3)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">Kweb$listenForWebsocketConnection$9</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
    <td class="coverageStat"/>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/4)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">Kweb$refreshAllPages$1</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
    <td class="coverageStat"/>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">Kweb$respondKweb$1</td>
    <td class="coverageStat"/>
  </tr>
  <tr>
    <td class="name">Kweb$respondKweb$2</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (1/1)
  </span>
</td>
    <td class="coverageStat"/>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (1/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (3/3)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">Kweb$respondKweb$3</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
    <td class="coverageStat"/>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/6)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/48)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">Kweb$respondKweb$3$1</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
    <td class="coverageStat"/>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/5)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">Kweb$respondKweb$3$2</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
    <td class="coverageStat"/>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">Kweb$respondKweb$4</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (1/1)
  </span>
</td>
    <td class="coverageStat"/>
<td class="coverageStat">
  <span class="percent">
    60%
  </span>
  <span class="absValue">
    (3/5)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    72.7%
  </span>
  <span class="absValue">
    (16/22)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">Kweb$respondKweb$4$1</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (1/1)
  </span>
</td>
    <td class="coverageStat"/>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (1/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (9/9)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">Kweb$respondKweb$5</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
    <td class="coverageStat"/>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/9)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">Kweb$respondKweb$6</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
    <td class="coverageStat"/>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/3)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">Kweb$respondKweb$bootstrapJS$1</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (1/1)
  </span>
</td>
    <td class="coverageStat"/>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (1/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (3/3)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">Kweb$setupKweb$1</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (1/1)
  </span>
</td>
    <td class="coverageStat"/>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (3/3)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (42/42)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">Kweb$setupKweb$1$1</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
    <td class="coverageStat"/>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/19)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">Kweb$setupKweb$1$2</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
    <td class="coverageStat"/>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/19)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">Kweb$setupKweb$1$3</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (1/1)
  </span>
</td>
    <td class="coverageStat"/>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (2/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (22/22)
  </span>
</td>
  </tr>
<tr>
  <td class="name"><strong>Total</strong></td>
<td class="coverageStat">
  <span class="percent">
    66%
  </span>
  <span class="absValue">
    (35/53)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    51.4%
  </span>
  <span class="absValue">
    (38/74)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    67.4%
  </span>
  <span class="absValue">
    (163/242)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    65.7%
  </span>
  <span class="absValue">
    (1082/1646)
  </span>
</td>
</tr>
</table>

<br/>
<br/>


<pre>
<code class="sourceCode" id="sourceCode">&nbsp;package kweb
&nbsp;
&nbsp;import com.google.common.cache.Cache
&nbsp;import com.google.common.cache.CacheBuilder
&nbsp;import io.ktor.server.application.*
&nbsp;import io.ktor.server.plugins.*
&nbsp;import io.ktor.http.*
&nbsp;import io.ktor.websocket.*
&nbsp;import io.ktor.websocket.Frame.*
&nbsp;import io.ktor.server.request.*
&nbsp;import io.ktor.server.response.*
&nbsp;import io.ktor.server.routing.*
&nbsp;import io.ktor.server.engine.*
&nbsp;import io.ktor.server.jetty.*
&nbsp;import io.ktor.server.plugins.defaultheaders.*
&nbsp;import io.ktor.server.plugins.compression.*
&nbsp;import io.ktor.server.websocket.*
&nbsp;import io.ktor.util.*
&nbsp;import kotlinx.serialization.decodeFromString
&nbsp;import kotlinx.serialization.encodeToString
&nbsp;import kotlinx.serialization.json.Json
&nbsp;import kotlinx.serialization.json.JsonElement
&nbsp;import kweb.client.*
&nbsp;import kweb.client.ClientConnection.Caching
&nbsp;import kweb.config.KwebConfiguration
&nbsp;import kweb.config.KwebDefaultConfiguration
&nbsp;import kweb.html.HtmlDocumentSupplier
&nbsp;import kweb.plugins.KwebPlugin
&nbsp;import kweb.plugins.staticFiles.ResourceFolder
&nbsp;import kweb.plugins.staticFiles.StaticFilesPlugin
&nbsp;import kweb.util.*
&nbsp;import kweb.util.NotFoundException
&nbsp;import mu.KotlinLogging
&nbsp;import org.jsoup.nodes.DataNode
&nbsp;import java.io.Closeable
&nbsp;import java.time.*
&nbsp;import java.util.*
&nbsp;import kotlin.math.abs
&nbsp;
&nbsp;private val logger = KotlinLogging.logger {}
&nbsp;
<b class="fc">&nbsp;class Kweb private constructor(</b>
<b class="fc">&nbsp;    val debug: Boolean,</b>
&nbsp;    plugins: List&lt;KwebPlugin&gt;,
<b class="fc">&nbsp;    val kwebConfig: KwebConfiguration,</b>
&nbsp;) : Closeable {
&nbsp;
&nbsp;    // This StaticFilesPlugin is used to serve static files required by Kweb and bundled plugins, it&#39;s
&nbsp;    // added to the plugin list implicitly.
<b class="fc">&nbsp;    val plugins = plugins + StaticFilesPlugin(ResourceFolder(&quot;kweb.static&quot;), &quot;/kweb_static&quot;)</b>
&nbsp;
&nbsp;    /**
&nbsp;     *
&nbsp;     * The core kwebserver, and the starting point for almost any Kweb app. This will create a HTTP server and respond
&nbsp;     * with a javascript page which will establish a websocket connection to retrieve and send instructions and data
&nbsp;     * between browser and server.
&nbsp;     *
&nbsp;     * @property port  The TCP port on which the HTTP server should listen
&nbsp;     * @property debug Should be set to true during development as it will provide useful warnings and other feedback,
&nbsp;     *                 but false during production because it is inefficient at scale
&nbsp;     * @property plugins A list of Kweb plugins to be loaded by this Kweb instance
&nbsp;     * @property buildPage A lambda which will build the webpage to be served to the user, this is where your code should
&nbsp;     *                     go
&nbsp;     */
&nbsp;    constructor(
&nbsp;        port: Int,
<b class="fc">&nbsp;        debug: Boolean = true,</b>
<b class="fc">&nbsp;        plugins: List&lt;KwebPlugin&gt; = Collections.emptyList(),</b>
<b class="fc">&nbsp;        httpsConfig: EngineSSLConnectorConfig? = null,</b>
<b class="fc">&nbsp;        kwebConfig: KwebConfiguration = KwebDefaultConfiguration(),</b>
&nbsp;        buildPage: WebBrowser.() -&gt; Unit,
<b class="fc">&nbsp;    ) : this(</b>
<b class="fc">&nbsp;        debug = debug,</b>
<b class="fc">&nbsp;        plugins = plugins,</b>
<b class="fc">&nbsp;        kwebConfig = kwebConfig,</b>
&nbsp;    ) {
<b class="fc">&nbsp;        logger.info(&quot;Initializing Kweb listening on port $port&quot;)</b>
&nbsp;
<b class="pc">&nbsp;        if (debug) {</b>
<b class="fc">&nbsp;            logger.warn(&quot;Debug mode enabled, if in production use KWeb(debug = false)&quot;)</b>
&nbsp;        }
&nbsp;
<b class="fc">&nbsp;        kwebConfig.validate()</b>
&nbsp;
<b class="fc">&nbsp;        server = createServer(port, httpsConfig, buildPage)</b>
&nbsp;
<b class="fc">&nbsp;        server!!.start()</b>
<b class="fc">&nbsp;        logger.info { &quot;KWeb is listening on port $port&quot; }</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * If you have an existing Ktor server, you can use the Kweb class as a feature. Adding this to your code is easy:
&nbsp;     *
&nbsp;     * ```
&nbsp;     *     install(DefaultHeaders)
&nbsp;     *     install(Compression)
&nbsp;     *     install(WebSockets) {
&nbsp;     *         pingPeriod = Duration.ofSeconds(10)
&nbsp;     *         timeout = Duration.ofSeconds(30)
&nbsp;     *     }
&nbsp;     *
&nbsp;     *     install(Kweb) {
&nbsp;     *         // Set debug or plugins here, if you&#39;d like
&nbsp;     *         buildPage = {
&nbsp;     *             // Your app goes here as it would using the Ktor constructor
&nbsp;     *         }
&nbsp;     *     }
&nbsp;     * ```
&nbsp;     *
&nbsp;     */
<b class="fc">&nbsp;    companion object Feature : BaseApplicationPlugin&lt;Application, Feature.Configuration, Kweb&gt; {</b>
&nbsp;        // Note that this is not KwebConfiguration, which is a different thing
<b class="nc">&nbsp;        class Configuration {</b>
<b class="nc">&nbsp;            var debug: Boolean = true</b>
<b class="nc">&nbsp;            var plugins: List&lt;KwebPlugin&gt; = Collections.emptyList()</b>
<b class="nc">&nbsp;            var kwebConfig: KwebConfiguration = KwebDefaultConfiguration()</b>
&nbsp;
&nbsp;            @Deprecated(&quot;Please use the Ktor syntax for defining page handlers instead: $buildPageReplacementCode&quot;)
<b class="nc">&nbsp;            var buildPage: (WebBrowser.() -&gt; Unit)? = null</b>
&nbsp;        }
&nbsp;
<b class="pc">&nbsp;        override val key = AttributeKey&lt;Kweb&gt;(&quot;Kweb&quot;)</b>
&nbsp;
&nbsp;        override fun install(pipeline: Application, configure: Configuration.() -&gt; Unit): Kweb {
<b class="nc">&nbsp;            val configuration = Configuration().apply(configure)</b>
<b class="nc">&nbsp;            configuration.kwebConfig.validate()</b>
<b class="nc">&nbsp;            val feature = Kweb(configuration.debug, configuration.plugins, configuration.kwebConfig)</b>
&nbsp;
&nbsp;            @Suppress(&quot;DEPRECATION&quot;)
<b class="nc">&nbsp;            configuration.buildPage?.let {</b>
<b class="nc">&nbsp;                logger.warn { &quot;Initializing Kweb with deprecated buildPage, this functionality will be removed in a future version&quot; }</b>
<b class="nc">&nbsp;                pipeline.installKwebOnRemainingRoutes(it)</b>
<b class="nc">&nbsp;            }</b>
<b class="nc">&nbsp;            feature.installRequiredKwebComponents(pipeline)</b>
&nbsp;
<b class="nc">&nbsp;            return feature</b>
&nbsp;        }
&nbsp;    }
&nbsp;
<b class="fc">&nbsp;    private val clientState: Cache&lt;String, RemoteClientState&gt; = CacheBuilder.newBuilder()</b>
<b class="fc">&nbsp;        .expireAfterAccess(kwebConfig.clientStateTimeout)</b>
<b class="pc">&nbsp;        .apply { if (kwebConfig.clientStateStatsEnabled) recordStats() }</b>
<b class="fc">&nbsp;        .removalListener&lt;String, RemoteClientState&gt; { rl -&gt;</b>
<b class="nc">&nbsp;            rl.value?.triggerCloseListeners()</b>
&nbsp;        }
<b class="fc">&nbsp;        .build()</b>
&nbsp;
&nbsp;    private var server: ApplicationEngine? = null
&nbsp;
&nbsp;    fun sendMessage(sessionId: String, server2ClientMessage: Server2ClientMessage) {
<b class="pc">&nbsp;        val wsClientData = clientState.getIfPresent(sessionId) ?: error(&quot;Client id $sessionId not found&quot;)</b>
&nbsp;        //TODO, do we need to change lastModified here? callJs will set it when the functionCall is originally created.
<b class="fc">&nbsp;        wsClientData.lastModified = Instant.now()</b>
<b class="fc">&nbsp;        wsClientData.send(server2ClientMessage)</b>
&nbsp;    }
&nbsp;
<b class="nc">&nbsp;    fun callJs(sessionId: String, funcCall: FunctionCall, debugInfo: DebugInfo? = null) {</b>
<b class="pc">&nbsp;        val wsClientData = clientState.getIfPresent(sessionId)</b>
<b class="nc">&nbsp;            ?: error(&quot;Client id $sessionId not found&quot;)</b>
<b class="fc">&nbsp;        wsClientData.lastModified = Instant.now()</b>
<b class="pc">&nbsp;        if (debug) {</b>
<b class="fc">&nbsp;            val dt = abs(random.nextLong()).toString(16)</b>
<b class="fc">&nbsp;            debugInfo?.let {</b>
<b class="fc">&nbsp;                wsClientData.debugTokens[dt] = it</b>
<b class="fc">&nbsp;            }</b>
&nbsp;        }
<b class="fc">&nbsp;        wsClientData.send(Server2ClientMessage(sessionId, funcCall))</b>
&nbsp;    }
&nbsp;
&nbsp;    fun addCallback(sessionId: String, callbackId: Int, callback: (JsonElement) -&gt; Unit) {
<b class="pc">&nbsp;        val wsClientData = clientState.getIfPresent(sessionId)</b>
<b class="nc">&nbsp;            ?: error(&quot;Can not add callback because: Client id $sessionId not found&quot;)</b>
<b class="fc">&nbsp;        wsClientData.lastModified = Instant.now()</b>
<b class="fc">&nbsp;        wsClientData.handlers[callbackId] = callback</b>
&nbsp;    }
&nbsp;
&nbsp;    fun removeCallback(clientId: String, callbackId: Int) {
<b class="pc">&nbsp;        clientState.getIfPresent(clientId)?.handlers?.remove(callbackId)</b>
&nbsp;    }
&nbsp;
&nbsp;    override fun close() {
<b class="fc">&nbsp;        logger.info(&quot;Shutting down Kweb&quot;)</b>
<b class="pc">&nbsp;        server?.stop(0, 0)</b>
<b class="fc">&nbsp;        clientState.asMap().values.forEach { it.triggerCloseListeners() }</b>
&nbsp;    }
&nbsp;
&nbsp;    private fun createServer(
&nbsp;        port: Int,
&nbsp;        httpsConfig: EngineSSLConnectorConfig?,
&nbsp;        buildPage: WebBrowser.() -&gt; Unit
&nbsp;    ): ApplicationEngine {
<b class="fc">&nbsp;        return embeddedServer(Jetty, applicationEngineEnvironment {</b>
<b class="fc">&nbsp;            this.module {</b>
<b class="fc">&nbsp;                install(DefaultHeaders)</b>
<b class="fc">&nbsp;                install(Compression)</b>
<b class="fc">&nbsp;                install(WebSockets) {</b>
<b class="fc">&nbsp;                    pingPeriod = Duration.ofSeconds(10)</b>
<b class="fc">&nbsp;                    timeout = Duration.ofSeconds(30)</b>
&nbsp;                }
&nbsp;
<b class="fc">&nbsp;                setupKweb(this, buildPage)</b>
&nbsp;            }
&nbsp;
<b class="fc">&nbsp;            connector {</b>
<b class="fc">&nbsp;                this.port = port</b>
<b class="fc">&nbsp;                this.host = &quot;0.0.0.0&quot;</b>
<b class="fc">&nbsp;            }</b>
&nbsp;
<b class="pc">&nbsp;            if (httpsConfig != null)</b>
<b class="nc">&nbsp;                connectors.add(httpsConfig)</b>
&nbsp;        })
&nbsp;    }
&nbsp;
&nbsp;    private fun setupKweb(application: Application, buildPage: WebBrowser.() -&gt; Unit) {
&nbsp;
<b class="fc">&nbsp;        application.routing {</b>
&nbsp;
<b class="pc">&nbsp;            get(&quot;/robots.txt&quot;) {</b>
<b class="nc">&nbsp;                kwebConfig.robotsTxt(call)</b>
&nbsp;            }
&nbsp;
<b class="pc">&nbsp;            get(&quot;/favicon.ico&quot;) {</b>
<b class="nc">&nbsp;                kwebConfig.faviconIco(call)</b>
&nbsp;            }
&nbsp;
<b class="fc">&nbsp;            get(&quot;${kwebConfig.urlPathPrefix}/{visitedUrl...}&quot;) {</b>
<b class="fc">&nbsp;                respondKweb(call, buildPage)</b>
&nbsp;            }
&nbsp;
&nbsp;        }
&nbsp;
<b class="fc">&nbsp;        installRequiredKwebComponents(application)</b>
&nbsp;    }
&nbsp;
&nbsp;    // We can&#39;t convert this param to receiver because it&#39;s called on receiver in the companion Feature
&nbsp;    private fun installRequiredKwebComponents(application: Application) {
<b class="fc">&nbsp;        HtmlDocumentSupplier.createDocTemplate(plugins, application.routing { })</b>
&nbsp;
<b class="fc">&nbsp;        application.routing {</b>
<b class="fc">&nbsp;            webSocket(&quot;/kweb_ws&quot;) {</b>
<b class="fc">&nbsp;                listenForWebsocketConnection()</b>
&nbsp;            }
&nbsp;        }
&nbsp;    }
&nbsp;
<b class="fc">&nbsp;    private suspend fun RemoteClientState?.ensureSessionExists(sock: DefaultWebSocketSession, sessionId: String) : RemoteClientState{</b>
<b class="pc">&nbsp;        if(this == null) {</b>
<b class="nc">&nbsp;            sock.close(CloseReason(CloseReason.Codes.NOT_CONSISTENT, &quot;Session not found. Please reload&quot;))</b>
<b class="nc">&nbsp;            error(&quot;Unable to find server state corresponding to client id ${sessionId}&quot;)</b>
&nbsp;        }
<b class="fc">&nbsp;        return this</b>
&nbsp;    }
&nbsp;
<b class="fc">&nbsp;    private suspend fun DefaultWebSocketSession.listenForWebsocketConnection() {</b>
<b class="fc">&nbsp;        val hello = Json.decodeFromString&lt;Client2ServerMessage&gt;((incoming.receive() as Text).readText())</b>
&nbsp;
<b class="pc">&nbsp;        if (hello.hello == null) {</b>
<b class="nc">&nbsp;            error(&quot;First message from client isn&#39;t &#39;hello&#39;&quot;)</b>
&nbsp;        }
&nbsp;
<b class="fc">&nbsp;        val remoteClientState = clientState.getIfPresent(hello.id).ensureSessionExists(this, hello.id)</b>
&nbsp;
<b class="pc">&nbsp;        assert(remoteClientState.clientConnection is Caching)</b>
<b class="fc">&nbsp;        logger.debug { &quot;Received message from remoteClient ${remoteClientState.id}, flushing outbound message cache&quot; }</b>
<b class="fc">&nbsp;        val cachedConnection = remoteClientState.clientConnection as Caching</b>
<b class="fc">&nbsp;        val webSocketClientConnection = ClientConnection.WebSocket(this)</b>
<b class="fc">&nbsp;        remoteClientState.clientConnection = webSocketClientConnection</b>
<b class="fc">&nbsp;        logger.debug { &quot;Set clientConnection for ${remoteClientState.id} to WebSocket, sending ${cachedConnection.size} cached messages&quot; }</b>
<b class="fc">&nbsp;        cachedConnection.read().forEach { webSocketClientConnection.send(it) }</b>
&nbsp;
&nbsp;
<b class="fc">&nbsp;        try {</b>
<b class="fc">&nbsp;            for (frame in incoming) {</b>
&nbsp;
<b class="fc">&nbsp;                logger.debug { &quot;WebSocket frame of type ${frame.frameType} received&quot; }</b>
&nbsp;
&nbsp;                // Retrieve the clientState so that it doesn&#39;t expire, replace it if it
&nbsp;                // has expired.
<b class="fc">&nbsp;                clientState.get(hello.id) { remoteClientState }</b>
&nbsp;
<b class="fc">&nbsp;                try {</b>
<b class="fc">&nbsp;                    logger.debug { &quot;Message received from client&quot; }</b>
&nbsp;
<b class="pc">&nbsp;                    if (frame is Text) {</b>
<b class="fc">&nbsp;                        val message = Json.decodeFromString&lt;Client2ServerMessage&gt;(frame.readText())</b>
&nbsp;
<b class="fc">&nbsp;                        logger.debug { &quot;Message received: $message&quot; }</b>
<b class="pc">&nbsp;                        if (message.error != null) {</b>
<b class="nc">&nbsp;                            handleError(message.error, remoteClientState)</b>
&nbsp;                        } else {
<b class="fc">&nbsp;                            when {</b>
<b class="pc">&nbsp;                                message.callback != null -&gt; {</b>
<b class="fc">&nbsp;                                    val (resultId, result) = message.callback</b>
<b class="pc">&nbsp;                                    val resultHandler = remoteClientState.handlers[resultId]</b>
<b class="nc">&nbsp;                                        ?: error(&quot;No resultHandler for $resultId, for client ${remoteClientState.id}&quot;)</b>
<b class="fc">&nbsp;                                    resultHandler(result)</b>
&nbsp;                                }
<b class="nc">&nbsp;                                message.keepalive -&gt; {</b>
<b class="nc">&nbsp;                                    logger.debug { &quot;keepalive received from client ${hello.id}&quot; }</b>
&nbsp;                                }
&nbsp;
&nbsp;                            }
&nbsp;                        }
&nbsp;                    }
<b class="nc">&nbsp;                } catch (e: Exception) {</b>
<b class="nc">&nbsp;                    logger.error(&quot;Exception while receiving websocket message&quot;, e)</b>
<b class="nc">&nbsp;                    kwebConfig.onWebsocketMessageHandlingFailure(e)</b>
&nbsp;                }
&nbsp;            }
&nbsp;        } finally {
<b class="fc">&nbsp;            logger.info(&quot;WS session disconnected for client id: ${remoteClientState.id}&quot;)</b>
<b class="fc">&nbsp;            remoteClientState.clientConnection = Caching()</b>
<b class="fc">&nbsp;        }</b>
&nbsp;    }
&nbsp;
&nbsp;    fun determineClientPrefix(call:ApplicationCall) : String{
<b class="fc">&nbsp;        val kwClientPrefixCookieName = &quot;kwebClientPrefix&quot;</b>
<b class="fc">&nbsp;        val currentPrefix = call.request.cookies.get(kwClientPrefixCookieName)</b>
<b class="fc">&nbsp;        return if(currentPrefix != null) {</b>
<b class="fc">&nbsp;            currentPrefix</b>
&nbsp;        }
&nbsp;        else {
<b class="fc">&nbsp;            val newClientPrefix = createNonce(6)</b>
<b class="fc">&nbsp;            call.response.cookies.append(kwClientPrefixCookieName, newClientPrefix)</b>
<b class="fc">&nbsp;            newClientPrefix</b>
&nbsp;        }
&nbsp;    }
&nbsp;
<b class="fc">&nbsp;    suspend fun respondKweb(call: ApplicationCall, buildPage: WebBrowser.() -&gt; Unit) {</b>
<b class="fc">&nbsp;        val htmlDocument = HtmlDocumentSupplier.getTemplateCopy()</b>
&nbsp;
&nbsp;        // The client prefix allows to monitor the resource usage (#Sessions, State Size) per User
<b class="fc">&nbsp;        val clientPrefix = determineClientPrefix(call)</b>
<b class="fc">&nbsp;        val kwebSessionId = clientPrefix + &quot;:&quot; + createNonce()</b>
&nbsp;
<b class="fc">&nbsp;        val remoteClientState = clientState.get(kwebSessionId) {</b>
<b class="fc">&nbsp;            RemoteClientState(id = kwebSessionId, clientConnection = Caching())</b>
&nbsp;        }
&nbsp;
<b class="fc">&nbsp;        val httpRequestInfo = HttpRequestInfo(call.request)</b>
&nbsp;
<b class="fc">&nbsp;        try {</b>
<b class="fc">&nbsp;            val webBrowser = WebBrowser(kwebSessionId, httpRequestInfo, this)</b>
&nbsp;
<b class="fc">&nbsp;            remoteClientState.addCloseHandler { webBrowser.close() }</b>
&nbsp;
<b class="fc">&nbsp;            webBrowser.htmlDocument.set(htmlDocument)</b>
<b class="pc">&nbsp;            if (debug) {</b>
<b class="fc">&nbsp;                warnIfBlocking(maxTimeMs = kwebConfig.buildpageTimeout.toMillis(), onBlock = { thread -&gt;</b>
<b class="nc">&nbsp;                    logger.warn { &quot;buildPage lambda must return immediately but has taken &gt; ${kwebConfig.buildpageTimeout}.  More info at DEBUG loglevel&quot; }</b>
&nbsp;
<b class="nc">&nbsp;                    val logStatementBuilder = StringBuilder()</b>
<b class="nc">&nbsp;                    logStatementBuilder.appendLine(&quot;buildPage lambda must return immediately but has taken &gt; ${kwebConfig.buildpageTimeout}, appears to be blocking here:&quot;)</b>
&nbsp;
<b class="nc">&nbsp;                    thread.stackTrace.pruneAndDumpStackTo(logStatementBuilder)</b>
<b class="nc">&nbsp;                    val logStatement = logStatementBuilder.toString()</b>
<b class="nc">&nbsp;                    logger.debug { logStatement }</b>
&nbsp;                }) {
<b class="fc">&nbsp;                    try {</b>
<b class="fc">&nbsp;                        buildPage(webBrowser)</b>
<b class="nc">&nbsp;                    } catch (e: Exception) {</b>
<b class="nc">&nbsp;                        logger.error(&quot;Exception thrown building page&quot;, e)</b>
&nbsp;                    }
<b class="fc">&nbsp;                    logger.debug { &quot;Outbound message queue size after buildPage is ${(remoteClientState.clientConnection as Caching).queueSize()}&quot; }</b>
&nbsp;                }
&nbsp;            } else {
<b class="nc">&nbsp;                try {</b>
<b class="nc">&nbsp;                    buildPage(webBrowser)</b>
<b class="nc">&nbsp;                } catch (e: Exception) {</b>
<b class="nc">&nbsp;                    logger.error(&quot;Exception thrown building page&quot;, e)</b>
&nbsp;                }
<b class="nc">&nbsp;                logger.debug { &quot;Outbound message queue size after buildPage is ${(remoteClientState.clientConnection as Caching).queueSize()}&quot; }</b>
&nbsp;            }
<b class="fc">&nbsp;            for (plugin in plugins) {</b>
&nbsp;                //this code block looks a little funny now, but I still think moving the message creation out of Kweb.callJs() was the right move
<b class="fc">&nbsp;                val js = plugin.executeAfterPageCreation()</b>
&nbsp;                //A plugin with an empty js string was breaking functionality.
<b class="pc">&nbsp;                if (js != &quot;&quot;) {</b>
<b class="nc">&nbsp;                    val pluginFunction = FunctionCall(js = js)</b>
<b class="nc">&nbsp;                    callJs(kwebSessionId, pluginFunction)</b>
&nbsp;                }
&nbsp;            }
&nbsp;
<b class="fc">&nbsp;            webBrowser.htmlDocument.set(null) // Don&#39;t think this webBrowser will be used again, but not going to risk it</b>
&nbsp;
<b class="fc">&nbsp;            val initialCachedMessages = remoteClientState.clientConnection as Caching</b>
&nbsp;
<b class="fc">&nbsp;            remoteClientState.clientConnection = Caching()</b>
&nbsp;
<b class="fc">&nbsp;            val initialMessages = initialCachedMessages.read()//the initialCachedMessages queue can only be read once</b>
&nbsp;
<b class="fc">&nbsp;            val cachedFunctions = mutableListOf&lt;String&gt;()</b>
<b class="fc">&nbsp;            val cachedIds = mutableListOf&lt;Int&gt;()</b>
<b class="fc">&nbsp;            for (msg in initialMessages) {</b>
<b class="fc">&nbsp;                val deserialedMsg = Json.decodeFromString&lt;Server2ClientMessage&gt;(msg)</b>
&nbsp;
&nbsp;                //We have a special case where some functions do not have jsId&#39;s. Trying to add one of those to the cache would cause problems.
<b class="fc">&nbsp;                for (funcCall in deserialedMsg.functionCalls) {</b>
<b class="fc">&nbsp;                    if (funcCall.jsId != null) {</b>
<b class="fc">&nbsp;                        if (!cachedIds.contains(funcCall.jsId)) {</b>
<b class="fc">&nbsp;                            val cachedFunction =</b>
<b class="fc">&nbsp;                                &quot;&quot;&quot;${funcCall.jsId} : function(${funcCall.parameters}) { ${funcCall.js} }&quot;&quot;&quot;</b>
<b class="fc">&nbsp;                            cachedFunctions.add(cachedFunction)</b>
<b class="fc">&nbsp;                            cachedIds.add(funcCall.jsId)</b>
&nbsp;                        }
&nbsp;
&nbsp;                    }
&nbsp;                }
&nbsp;            }
&nbsp;
<b class="fc">&nbsp;            val functionCacheString = &quot;let cachedFunctions = { \n${cachedFunctions.joinToString(separator = &quot;,\n&quot;)} };&quot;</b>
&nbsp;
<b class="fc">&nbsp;            val bootstrapJS = BootstrapJs.hydrate(</b>
<b class="fc">&nbsp;                kwebSessionId,</b>
<b class="fc">&nbsp;                initialMessages.joinToString(separator = &quot;\n&quot;) { &quot;handleInboundMessage($it);&quot; },</b>
<b class="fc">&nbsp;                functionCacheString,</b>
<b class="fc">&nbsp;                kwebConfig.clientOfflineToastTextTemplate</b>
&nbsp;            )
&nbsp;
<b class="fc">&nbsp;            htmlDocument.head().appendElement(&quot;script&quot;)</b>
<b class="fc">&nbsp;                .attr(&quot;language&quot;, &quot;JavaScript&quot;)</b>
<b class="fc">&nbsp;                .appendChild(DataNode(bootstrapJS))</b>
<b class="fc">&nbsp;            htmlDocument.outputSettings().prettyPrint(debug)</b>
&nbsp;
&nbsp;
<b class="fc">&nbsp;            call.respondText(htmlDocument.outerHtml(), ContentType.Text.Html)</b>
<b class="nc">&nbsp;        } catch (nfe: NotFoundException) {</b>
<b class="nc">&nbsp;            call.response.status(HttpStatusCode.NotFound)</b>
<b class="nc">&nbsp;            call.respondText(&quot;URL ${call.request.uri} not found.&quot;, ContentType.parse(&quot;text/plain&quot;))</b>
<b class="nc">&nbsp;        } catch (e: Exception) {</b>
<b class="nc">&nbsp;            val logToken = random.nextLong().toString(16)</b>
&nbsp;
<b class="nc">&nbsp;            logger.error(e) { &quot;Exception thrown while rendering page, code $logToken&quot; }</b>
&nbsp;
<b class="nc">&nbsp;            call.response.status(HttpStatusCode.InternalServerError)</b>
<b class="nc">&nbsp;            call.respondText(</b>
&nbsp;                &quot;&quot;&quot;
&nbsp;                        Internal Server Error.
&nbsp;
<b class="nc">&nbsp;                        Please include code $logToken in any error report to help us track it down.</b>
<b class="nc">&nbsp;&quot;&quot;&quot;.trimIndent()</b>
&nbsp;            )
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    private fun handleError(error: Client2ServerMessage.ErrorMessage, remoteClientState: RemoteClientState) {
<b class="nc">&nbsp;        val debugInfo = remoteClientState.debugTokens[error.debugToken]</b>
<b class="nc">&nbsp;            ?: error(&quot;DebugInfo message not found&quot;)</b>
<b class="nc">&nbsp;        val logStatementBuilder = StringBuilder()</b>
<b class="nc">&nbsp;        logStatementBuilder.appendLine(&quot;JavaScript message: &#39;${error.error.message}&#39;&quot;)</b>
<b class="nc">&nbsp;        logStatementBuilder.appendLine(&quot;Caused by ${debugInfo.action}: &#39;${debugInfo.js}&#39;:&quot;)</b>
&nbsp;        // TODO: Filtering the stacktrace like this seems a bit kludgy, although I can&#39;t think
&nbsp;        // TODO: of a specific reason why it would be bad.
<b class="nc">&nbsp;        debugInfo.throwable.stackTrace.pruneAndDumpStackTo(logStatementBuilder)</b>
<b class="nc">&nbsp;        logger.error(logStatementBuilder.toString())</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Forces all currently connected clients to refresh their pages.  This can be useful if there has been a
&nbsp;     * code-change, for example.
&nbsp;     *
&nbsp;     * If there are a large number of connected clients this could place a lot of load on the server.  An
&nbsp;     * unexpected page refresh may also confuse website visitors or cause the loss of unsaved form data.
&nbsp;     */
&nbsp;    fun refreshAllPages() {
<b class="nc">&nbsp;        if (!debug) {</b>
<b class="nc">&nbsp;            logger.warn { &quot;refreshAllPages() called but Kweb is not in debug mode, ignored&quot; }</b>
&nbsp;        } else {
<b class="nc">&nbsp;            for (client in clientState.asMap().values) {</b>
<b class="nc">&nbsp;                val refreshCall = FunctionCall(js = &quot;window.location.reload(true);&quot;)</b>
<b class="nc">&nbsp;                val message = Server2ClientMessage(client.id, refreshCall)</b>
<b class="nc">&nbsp;                client.clientConnection.send(Json.encodeToString(message))</b>
&nbsp;            }
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;
&nbsp;}
&nbsp;
&nbsp;data class DebugInfo(val js: String, val action: String, val throwable: Throwable)
</code>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
      hljs.highlightAll()
      hljs.initLineNumbersOnLoad();
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2022-11-19 12:41</div>
</div>
</body>
</html>
